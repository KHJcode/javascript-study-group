# Garbage Collection

원시값, 객체, 함수 등 우리가 만드는 것들은 모두 메모리의 어느 한 부분을 차지한다. 이때 자바스크립트는 눈에 보이지 않는 곳에서 메모리를 관리하며 쓸모없어지게 된 공간을 정리한다. 이 동작을 하는 것을 가비지 컬렉터(garbage collector) 이라고 한다. 그렇다면 가비지 컬렉터는 쓸모없어진 기준을 어떻게 판단할까?

## 가비지 컬렉션 기준

자바스크립트는 '도달 가능성' 이라는 것을 이용하여 기준을 정하여 메모리를 관리한다. 
'도달 가능하다는' 것은 말 그대로 접근할 수 있고, 사용할 수 있다는 의미이다. 

다음 값들은 '도달 가능' 하기 때문에 특정한 이유없이 메모리 관리대상에 포함되지 않는다.

1. 현재 함수의 지역변수와 전역변수
2. 중첩 함수의 체인이 있는 함수에서 사용되는 변수와 매개변수
3. 전역 변수

또한 위 값들에서 참조하고 있는 값 또한 '도달 가능' 하기 때문에 삭제되지 않는다. 

### 예시 : 참조

```jsx
let user = {
    name: "jewon"
}
```

전역변수 "user" 는 name 이라는 프로퍼티를 가진 객체를 참조하고 있다. 현재는 '도달 가능' 한 상태이다. 

```jsx
let user = null;
```

만약 전역변수 "user" 에 null 대입하면, 참조가 사라지며 해당 객체는 더 이상 도달하지 못하기 때문에 가비지 컬렉터가 자동으로 메모리에서 삭제한다. 

```jsx
let user = {
    name: "jewon"
};

let admin = user;
```

다음과 같이 미리 다른 변수에 복사시켜 놓으면 참조할 수 있기 때문에, 삭제되지 않는다. 만약 admin 변수도 또한 참조할 수 없게 되면, 마찬가지로 가비지 컬렉터에 의해 삭제된다. 

### 예시 : 연결된 객체

```jsx
function marry(man, woman) {
  woman.husband = man; 
  man.wife = woman; // 두 객체가 서로 참조하게 한다. 

  return {
    father: man,
    mother: woman // 새로운 객체를 반환함으로써 다시 두 객체를 참조한다. 
  }
}

let family = marry({
  name: "John"
}, {
  name: "Ann"
});
```

marry 라는 함수가 매개변수로 받은 두 객체를 서로 참조하게 하고, 새로운 객체를 반환하면서 그 객체와 두 객체가 참조하게 한다. 

```jsx
delete family.father;
delete family.mother.husband;
```

name: "John" 을 가진 객체의 참조를 모두 지우면, 더이상 객체를 참조할 수 없으므로, 삭제된다. 
이후 family 라는 객체의 mother 라는 객체만 남게 된다. 

```jsx
family = null;
```
만약 family 라는 근원 객체가 삭제된다면, 내부의 있던 모든 값에 접근할 수 없게 되어 전부 메모리 상에서 지워진다. 

## 동작 알고리즘

가비지 컬렉터는 최상위에 있는 항상 '도달 가능' 한 위치부터 시작하여 순차적으로 마킹하며 모든 값을 지난다. 이때 최상위 값과 연결되지 않은 값은 모두 삭제한다. 

## 참고 문서

- https://ko.javascript.info/garbage-collection
  